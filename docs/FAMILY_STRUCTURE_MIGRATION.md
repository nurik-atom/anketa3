# Миграция структуры семьи в анкете

## Описание изменений

Поле "члены семьи" (`family_members`) в анкете было разделено на три отдельные категории:

1. **Родители** - содержит информацию об отце и матери (максимум 2 записи)
2. **Братья и сестры** - содержит информацию о братьях и сестрах (неограниченно)
3. **Дети** - содержит информацию о детях кандидата (неограниченно)

## Новая структура JSON

### Родители (parents)
```json
{
  "relation": "Отец|Мать",
  "birth_year": "1970",
  "profession": "механик"
}
```

### Братья и сестры (siblings)
```json
{
  "relation": "Брат|Сестра", 
  "birth_year": "1985"
}
```

### Дети (children)
```json
{
  "name": "Александр",
  "birth_year": "2010"
}
```

### Полная структура в БД
```json
{
  "parents": [
    {
      "relation": "Отец",
      "birth_year": "1970", 
      "profession": "механик"
    },
    {
      "relation": "Мать",
      "birth_year": "1975",
      "profession": "учитель"
    }
  ],
  "siblings": [
    {
      "relation": "Брат",
      "birth_year": "1985"
    },
    {
      "relation": "Сестра", 
      "birth_year": "1990"
    }
  ],
  "children": [
    {
      "name": "Александр",
      "birth_year": "2010"
    },
    {
      "name": "Мария",
      "birth_year": "2015"
    }
  ]
}
```

## Обратная совместимость

Система автоматически определяет формат данных:

1. **Новый формат** - если в JSON есть ключи `parents`, `siblings`, `children`
2. **Старый формат** - если данные представлены в виде массива с полями `type`, `birth_year`, `profession`

При загрузке старых данных происходит автоматическая миграция в новую структуру в runtime.

## Миграция существующих данных

Для миграции существующих данных в БД используйте команду:

```bash
# Просмотр изменений без сохранения
php artisan family:migrate-structure --dry-run

# Выполнение миграции
php artisan family:migrate-structure
```

## Изменения в коде

### Новые свойства Livewire компонента
- `public $parents = []` - массив родителей
- `public $siblings = []` - массив братьев/сестер  
- `public $children = []` - массив детей

### Новые методы
- `addParent()` / `removeParent($index)` - управление родителями
- `addSibling()` / `removeSibling($index)` - управление братьями/сестрами
- `addChild()` / `removeChild($index)` - управление детьми
- `loadFamilyCategories()` - загрузка с обратной совместимостью
- `buildFamilyStructure()` - построение JSON для сохранения

### Валидация

Добавлены новые правила валидации:
- Максимум 2 родителя
- Обязательные поля для каждой категории
- Проверка допустимых значений для типов родства

## Интерфейс

Новый интерфейс разделен на три секции:
1. **Родители** - синие кнопки, максимум 2 записи
2. **Братья и сестры** - зеленые кнопки  
3. **Дети** - фиолетовые кнопки

Каждая секция имеет свои поля в соответствии с требованиями:
- Родители: родство + год рождения + профессия
- Братья/сестры: родство + год рождения
- Дети: имя + год рождения

## Тестирование

Рекомендуется протестировать:
1. Создание новой анкеты с новой структурой
2. Редактирование существующей анкеты со старой структурой
3. Миграцию данных командой
4. Валидацию для каждой категории
